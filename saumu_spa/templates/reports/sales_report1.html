{% extends 'reports/base.html' %}

{% block content %}
<style type="text/css">
   
</style>

<div class="projects-orders-row">
    <div class="projects-card">
        <div class="table-header">
            <h2>Appointments</h2>
            <p class="projects-subtitle">5 completed this month</p>
            <button class="add-appointment-btn" data-bs-toggle="modal" data-bs-target="#addAppointmentModal">
                <i class="fas fa-plus"></i> Add Walk-In
            </button>
        </div>

        <div class="dropdown-container">
            <div class="filter-dropdown">
                <button class="btn dropdown-toggle" type="button" id="statusFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-filter"></i>
                    <span id="statusFilterText">
                        {% if request.GET.status == "completed" %}Completed Only
                        {% elif request.GET.status == "transacted" %}Transacted Only
                        {% else %}Completed & Transacted{% endif %}
                    </span>
                </button>
                <ul class="dropdown-menu status1" aria-labelledby="statusFilterDropdown">
                    <li><a class="dropdown-item" href="#" data-value="completed,transacted">Completed & Transacted</a></li>
                    <li><a class="dropdown-item" href="#" data-value="completed">Completed Only</a></li>
                    <li><a class="dropdown-item" href="#" data-value="transacted">Transacted Only</a></li>
                </ul>
            </div>

            <div class="entries-dropdown">
                <button class="btn dropdown-toggle " type="button" id="entriesPerPageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Show: <span id="entriesPerPageText">{{ request.GET.entries|default:"10" }}</span>
                </button>
                <ul class="dropdown-menu entries1" aria-labelledby="entriesPerPageDropdown">
                    <li><a class="dropdown-item" href="#" data-value="10">10</a></li>
                    <li><a class="dropdown-item" href="#" data-value="20">20</a></li>
                    <li><a class="dropdown-item" href="#" data-value="30">30</a></li>
                </ul>
            </div>
        </div>

        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>CUSTOMER NAME</th>
                        <th>STAFF NAME</th>
                        <th>AMOUNT PAID</th>
                        <th>COMPLETION</th>
                        <th>ACTION</th>
                    </tr>
                </thead>
                <tbody id="appointmentTableBody">
                    {% for appointment in appointments %}
                    <tr>
                        <td>{{ appointment.customer.first_name }} {{ appointment.customer.last_name }}</td>
                        <td>{{ appointment.staff.first_name }} {{ appointment.staff.last_name }}</td>
                        <td>${{ appointment.billing.total|default:"0.00" }}</td>
                        <td>
                            <div class="progress-bar" style="width: {{ appointment.completion_percentage }}%; {% if appointment.status == 'completed' %}background-color: orange;{%elif appointment.status == 'transacted' %}background-color: green;{%elif appointment.status == 'confirmed' %} background-color: orange;{%elif appointment.status == 'cancelled' %}background-color: red {%endif%}"></div>
                        </td>
                        <td>
                            <div class="dropdown">
                                <button class="btn btn-link text-dark p-0" type="button" id="actionsDropdown{{ appointment.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-ellipsis-h"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="actionsDropdown{{ appointment.id }}">
                                    {% if appointment.status == 'completed' %}
                                    <li>
                                        <a class="dropdown-item mark-transacted-link" href="#" data-id="{{ appointment.id }}">
                                            <i class="fas fa-check-circle me-2"></i> Mark as Transacted
                                        </a>
                                    </li>
                                    {% endif %}
                                    <li>
                                        <a class="dropdown-item edit-link" href="#" data-id="{{ appointment.id }}">
                                            <i class="fas fa-edit me-2"></i> Edit
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item cancel-link" href="#" data-id="{{ appointment.id }}">
                                            <i class="fas fa-ban me-2"></i> Cancel
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item delete-link" href="#" data-id="{{ appointment.id }}">
                                            <i class="fas fa-trash-alt me-2"></i> Delete
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="pagination">
            <button id="prevPageBtn" {% if not appointments.has_previous %}disabled{% endif %}>Previous</button>
            <span class="page-info">Page <span id="currentPage">{{ appointments.number }}</span> of <span id="totalPages">{{ appointments.paginator.num_pages }}</span></span>
            <button id="nextPageBtn" {% if not appointments.has_next %}disabled{% endif %}>Next</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const tableBody = document.getElementById('appointmentTableBody');
    const prevPageBtn = document.getElementById('prevPageBtn');
    const nextPageBtn = document.getElementById('nextPageBtn');
    const currentPageSpan = document.getElementById('currentPage');
    const totalPagesSpan = document.getElementById('totalPages');
    const statusFilterText = document.getElementById('statusFilterText');
    const entriesPerPageText = document.getElementById('entriesPerPageText');

    let currentPage = {{ appointments.number|default:1 }};
    let entriesPerPage = {{ request.GET.entries|default:10 }};
    let statusFilter = '{{ request.GET.status|default:"completed,transacted" }}';

    // Function to initialize Bootstrap dropdowns
    function initializeDropdowns() {
        console.log('Initializing dropdowns...');
        const dropdownElements = tableBody.querySelectorAll('[data-bs-toggle="dropdown"]:not(.initialized)');
        console.log('Found new dropdowns:', dropdownElements.length);
        dropdownElements.forEach(element => {
            if (typeof bootstrap !== 'undefined' && bootstrap.Dropdown) {
                new bootstrap.Dropdown(element);
                element.classList.add('initialized');
                console.log('Initialized dropdown for ID:', element.id);
            } else {
                console.error('Bootstrap JS not loaded or Dropdown not available');
                // Fallback: manual toggle
                element.addEventListener('click', function() {
                    const menu = element.nextElementSibling;
                    menu.classList.toggle('show');
                });
            }
        });
    }

    // Function to fetch and update table content
    function updateTable() {
        console.log('Fetching data for page:', currentPage);
        fetch(`/billing/sales-list/?status=${statusFilter}&page=${currentPage}&entries=${entriesPerPage}`, {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => {
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return response.json();
        })
        .then(data => {
            tableBody.innerHTML = '';
            data.appointments.forEach(appt => {
                const row = `
                    <tr>
                        <td>${appt.customer_name}</td>
                        <td>${appt.staff_name}</td>
                        <td>$${appt.amount_paid}</td>
                        <td><div class="progress-bar" style="width: ${appt.completion_percentage}%;"></div></td>
                        <td>
                            <div class="dropdown">
                                <button class="btn btn-link text-dark p-0" type="button" id="actionsDropdown${appt.id}" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-ellipsis-h"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="actionsDropdown${appt.id}">
                                    ${appt.status === 'completed' ? `
                                    <li>
                                        <a class="dropdown-item mark-transacted-link" href="#" data-id="${appt.id}">
                                            <i class="fas fa-check-circle me-2"></i> Mark as Transacted
                                        </a>
                                    </li>` : ''}
                                    <li>
                                        <a class="dropdown-item edit-link" href="#" data-id="${appt.id}">
                                            <i class="fas fa-edit me-2"></i> Edit
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item cancel-link" href="#" data-id="${appt.id}">
                                            <i class="fas fa-ban me-2"></i> Cancel
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item delete-link" href="#" data-id="${appt.id}">
                                            <i class="fas fa-trash-alt me-2"></i> Delete
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                `;
                tableBody.insertAdjacentHTML('beforeend', row);
            });

            // Reinitialize dropdowns
            initializeDropdowns();

            // Update pagination
            currentPageSpan.textContent = data.pagination.current_page;
            totalPagesSpan.textContent = data.pagination.total_pages;
            prevPageBtn.disabled = !data.pagination.has_previous;
            nextPageBtn.disabled = !data.pagination.has_next;

            // Reattach jQuery handlers from base.html to new elements
            $(tableBody).find('.mark-transacted-link').off('click').on('click', function(e) {
                e.preventDefault();
                const appointmentId = $(this).data('id');
                const markAsTransactedUrl = "{% url 'billing:mark_as_transacted' appointment_id=0 %}".replace('/0', '') + appointmentId + '/';
                $.ajax({
                    url: markAsTransactedUrl,
                    method: "POST",
                    headers: { 'X-CSRFToken': getCookie('csrftoken') },
                    success: function(response) {
                        if (response.success) {
                            updateTable();
                        } else {
                            console.error('Mark as Transacted error:', response.error);
                        }
                    },
                    error: function() {
                        console.error('Mark as Transacted failed');
                    }
                });
            });

            $(tableBody).find('.edit-link').off('click').on('click', function(e) {
                e.preventDefault();
                const appointmentId = $(this).data('id');
                isEditing1 = true;
                const getAppointmentDetailsUrl = "{% url 'billing:get_appointment_details' appointment_id=0 %}".replace('/0', '') + appointmentId + '/';
                $.ajax({
                    url: getAppointmentDetailsUrl,
                    method: "GET",
                    success: function(response) {
                        $('#addAppointmentModalLabel').text('Edit Appointment');
                        $('#appointment_id').val(response.id);
                        $('#walkin_customer_name').val(response.customer_name);
                        $('#walkin_staff_name').val(response.staff_id);
                        $('#walkin_service').val(response.service_id);
                        $('#walkin_amount_paid').val(response.amount_paid);
                        $('#addAppointmentModal').modal('show');
                    },
                    error: function() {
                        console.error('Edit fetch failed');
                    }
                });
            });

            $(tableBody).find('.delete-link').off('click').on('click', function(e) {
                e.preventDefault();
                const appointmentId = $(this).data('id');
                const deleteAppointmentUrl = "{% url 'billing:delete_appointment' appointment_id=0 %}".replace('/0', '') + appointmentId + '/';
                if (confirm('Are you sure you want to delete this appointment?')) {
                    $.ajax({
                        url: deleteAppointmentUrl,
                        method: "POST",
                        headers: { 'X-CSRFToken': getCookie('csrftoken') },
                        success: function(response) {
                            if (response.success) {
                                updateTable();
                            } else {
                                console.error('Delete error:', response.error);
                            }
                        },
                        error: function() {
                            console.error('Delete failed');
                        }
                    });
                }
            });
        })
        .catch(error => console.error('Error fetching data:', error));
    }

    // Event Listeners
    document.querySelectorAll('.filter-dropdown .dropdown-item').forEach(item => {
        item.addEventListener('click', function (e) {
            e.preventDefault();
            statusFilter = this.getAttribute('data-value');
            statusFilterText.textContent = this.textContent;
            currentPage = 1;
            updateTable();
        });
    });

    document.querySelectorAll('.entries-dropdown .dropdown-item').forEach(item => {
        item.addEventListener('click', function (e) {
            e.preventDefault();
            entriesPerPage = this.getAttribute('data-value');
            entriesPerPageText.textContent = this.textContent;
            currentPage = 1;
            updateTable();
        });
    });

    prevPageBtn.addEventListener('click', function () {
        if (currentPage > 1) {
            currentPage--;
            updateTable();
        }
    });

    nextPageBtn.addEventListener('click', function () {
        currentPage++;
        updateTable();
    });

    // Initial initialization
    initializeDropdowns();
});
</script>
{% endblock %}




















<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>Creative Tim Sidebar</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
     <!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

     <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<style type="text/css">
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
}

/* Top Navbar */
.top-navbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 60px;
    background-color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    z-index: 1000;
}

.navbar-brand {
    font-size: 18px;
    font-weight: bold;
    color: #000;
}

.hamburger {
    font-size: 24px;
    cursor: pointer;
    color: #000;
    display: none; /* Hidden on desktop by default */
}

/* Sidebar */
.sidebar {
    position: fixed;
    top: 60px; /* Below top navbar */
    left: 3px; /* 3px gap from the left edge */
    width: 15%; /* 30% of the page on desktop */
    height: calc(100vh - 60px); /* Full height minus navbar */
    background-color: #fff;
    border-radius: 0 0 8px 0;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
    z-index: 999;
    transition: transform 0.4s ease-in-out !important; /* Smooth slide animation */
        overflow-y: auto; /* Enable vertical scrolling */
    scrollbar-width: thin; /* Firefox - thin scrollbar */
    scrollbar-color: #ccc transparent; /* Firefox scrollbar color */
}

@media (max-width: 1024px) {
    .sidebar {
        transform: translateX(-100%); /* Closed by default on tablet/phone */
    }

    .sidebar.active {
        transform: translateX(0); /* Open when toggled */
        width: 70%;
    }
}

.sidebar-header {
    padding: 15px;
    border-bottom: 1px solid #f5f5f5;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    color: #666;
}

.sidebar-header i {
    font-size: 12px;
}

.sidebar-menu {
    list-style: none;
    padding: 10px 0;
}

.sidebar-menu li {
    padding: 12px 15px;
    font-size: 14px;
    color: #666;
    display: flex;
    align-items: center;
    cursor: default; /* Static, no interactivity */
}

.sidebar-menu li i {
    margin-right: 10px;
    font-size: 14px;
}

.sidebar-menu li.active {
    background-color: #333;
    color: #fff;
    font-weight: 500;
}

.sidebar-menu .menu-group {
    padding: 15px 15px 10px;
    font-size: 12px;
    color: #999;
    text-transform: uppercase;
}

.sidebar-footer {
    padding: 15px;
    border-top: 1px solid #f5f5f5;
}

.btn-documentation, .btn-upgrade {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    cursor: default; /* Static, no interactivity */
}

.btn-documentation {
    background-color: #fff;
    color: #000;
    border: 1px solid #ccc;
}

.btn-upgrade {
    background-color: #000;
    color: #fff;
    font-weight: bold;
}

/* Main Content */
.main-content {
    margin-left: 15%; /* 30% for sidebar on desktop */
    padding: 80px 3% 20px; /* Top padding for navbar */
    transition: margin-left 0.3s ease;
}

@media (max-width: 1024px) {
    .main-content {
        margin-left: 0; /* No margin on tablet/phone, content stays full width */
    }
}

/* Responsiveness */
@media (max-width: 1024px) and (min-width: 769px) { /* Tablet */
    .sidebar {
        width: 50%; /* Covers 50% of the screen when open */
    }

    .hamburger {
        display: block; /* Show hamburger on tablet */
    }

    .top-navbar .navbar-brand {
        display: block; /* Show logo/title on tablet */
    }
}

@media (max-width: 768px) { /* Phone */
    .sidebar {
        width: 100%; /* Covers 100% of the screen when open */
    }

    .hamburger {
        display: block; /* Show hamburger on phone */
    }

    .top-navbar .navbar-brand {
        display: block; /* Show logo/title on phone */
    }
}

/* Hide hamburger on desktop (above 1024px) */
@media (min-width: 1025px) {
    .hamburger {
        display: none; /* Hide hamburger icon on desktop */
    }
}

/* Ensure icons are minimalistic and outlined (using Font Awesome) */
.sidebar-menu i, .hamburger i {
    width: 14px; /* Match icon size in image */
}


/* Webkit Scrollbar (Chrome, Edge, Safari) */
.sidebar::-webkit-scrollbar {
    width: 6px;
}

.sidebar::-webkit-scrollbar-thumb {
    background-color: #ccc;
    border-radius: 3px;
}

.sidebar::-webkit-scrollbar-track {
    background: transparent;
}
/* Dashboard Content */
.dashboard {
    padding: 20px 6px;
    background-color: #fff;
    color: #666;
    font-size: 14px;
}

.dashboard h1 {
    font-size: 24px;
    color: #000;
    margin-bottom: 10px;
}

.dashboard-subtitle {
    font-size: 14px;
    color: #999;
    margin-bottom: 20px;
}

.metrics-row, .charts-row, .projects-orders-row {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.chart-card, .projects-card, .orders-card {
    background-color: #fff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    flex: 1;
    
}

.metric-card {
    text-align: center;
    background-color: #fff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    flex: 1;
    min-width: 0; /* Prevent overflow */
    position: relative;
    overflow: hidden;
    background-color: #fff; /* White box */
    padding: 20px;
    border-radius: 8px;
    position: relative; /* For pseudo-elements or layering */
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.15), /* Deep outer shadow for lift */
        0 -4px 15px rgba(255, 255, 255, 0.8), /* Top highlight for contrast */
        inset 0 2px 10px rgba(0, 0, 0, 0.05); /* Inner shadow for depth */
    border: 1px solid rgba(0, 0, 0, 0.03); /* Subtle edge definition */
    background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 1) 0%,
        rgba(245, 245, 245, 1) 100%
    ); /* Faint gradient for surface texture */
    z-index: 1; /* Ensure it sits above background */
}

.metric-card h2 {
    font-size: 0.8rem;
    color: #636363;
    margin-bottom: 5px;
    text-align: left;
}

.metric-value {
   font-size: 1.5rem;
    color: #636363;
    font-weight: bold;
    margin-bottom: 5px;
    text-align: left;
}

.metric-change {
  font-size: 12px;
    margin-bottom: 0;
    text-align: left;
    color: #4caf50;
}
.metric-change:contains('−') {
    color: #f44336; /* Red for negative changes */
}

.metric-icon {
   position: absolute;
    top: 20px;
    right: 20px;
    font-size: 24px;
    color: #fff;
    background-color: #000;
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.chart-card h2, .projects-card h2, .orders-card h2 {
    font-size: 16px;
    color: #000;
    margin-bottom: 10px;

}

.chart-card{
  background-color: #fff; /* White box */
    padding: 20px;
    border-radius: 8px;
    position: relative; /* For pseudo-elements or layering */
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.15), /* Deep outer shadow for lift */
        0 -4px 15px rgba(255, 255, 255, 0.8), /* Top highlight for contrast */
        inset 0 2px 10px rgba(0, 0, 0, 0.05); /* Inner shadow for depth */
    border: 1px solid rgba(0, 0, 0, 0.03); /* Subtle edge definition */
    background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 1) 0%,
        rgba(245, 245, 245, 1) 100%
    ); /* Faint gradient for surface texture */
    z-index: 1; /* Ensure it sits above background */
}
.chart-subtitle, .projects-subtitle, .orders-subtitle {
    font-size: 12px;
    color: #999;
    margin-bottom: 15px;
}

.bar-chart {
    height: 150px;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: 10px;
}

.bar {
    width: 12%;
    background-color: #4caf50;
    margin: 0 2px;
    border-radius: 10px;
}
.bar-chart + .chart-update{
    border-top: 1px solid #ddd;
}

.line-chart {
    height: 150px;
    position: relative;
    border-bottom: 1px solid #ddd;
}

.dot {
    position: absolute;
    width: 8px;
    height: 8px;
    background-color: #4caf50;
    border-radius: 50%;
    transform: translate(-50%, -50%);
}

.chart-update {
    font-size: 12px;
    color: #999;
    text-align: left;
}

.projects-card table {
    width: 100%;
    border-collapse: collapse;
}

.projects-card th, .projects-card td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #f5f5f5;
}

.projects-card th {
    font-weight: bold;
    color: #a3a3a3;
}

.progress-bar {
    height: 8px;
    background-color: #4caf50;
    border-radius: 4px;
}

.orders-list {
    list-style: none;
    padding: 0;
}

.orders-list li {
    padding: 10px 0;
    border-bottom: 1px solid #f5f5f5;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #666;
}

.orders-list i {
    margin-right: 10px;
    color: #666;
}

.orders-list span {
    font-size: 12px;
    color: #999;
}

.dashboard-footer {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #f5f5f5;
    color: #999;
    font-size: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.footer-links {
    display: flex;
    gap: 10px;
}

.footer-links span, .footer-links i {
    color: #999;
    cursor: default; /* Matches static sidebar behavior */
}
@media (min-width: 992px) {
    .metrics-row{
        flex-wrap: wrap;
    }

    .metric-card {
            flex: none;
             width: 23%;
    }
}
@media (min-width: 1270px) {
    .metric-card{
        width: 23.5%;
    }
}
@media (min-width: 1454px) {
    .metric-card{
        width: 23.7%;
    }
}


/* Responsiveness for Content */
@media (max-width: 1024px) and (min-width: 769px) { /* Tablet */
   .charts-row, .projects-orders-row {
        flex-direction: column;
    }
    .metrics-row {
        flex-direction: row;
        flex-wrap: wrap;
    }
     .chart-card, .projects-card, .orders-card {
        width: 100%;
    }
.metric-card {
        flex: 0 0 calc(50% - 10px); /* Two cards side by side */
        margin-bottom: 20px;
    }
    .dashboard, .metric-card, .chart-card, .projects-card, .orders-card {
        font-size: 14px; /* Maintain readability */
    }
}

@media (max-width: 768px) { /* Phone */
    .metrics-row, .charts-row, .projects-orders-row {
        flex-direction: column;
    }

    .chart-card, .projects-card, .orders-card {
        width: 100%;
    }
    .metric-card {
        width: 100%;
       
    }
    .metric-value {
        font-size: 18px; /* Slightly reduced for readability on mobile */
    }
    .metric-card h2, .metric-change {
        font-size: 12px; /* Reduced font size for mobile readability */
    }

    .metric-icon {
        font-size: 20px;
        width: 30px;
        height: 30px;
        top: 15px;
        right: 15px;
    }

    .dashboard, .metric-card, .chart-card, .projects-card, .orders-card {
        font-size: 12px; /* Slightly reduced for better readability on mobile */
    }

    .bar-chart, .line-chart {
        height: 100px; /* Reduce chart height on mobile */
    }

    .metric-value {
        font-size: 18px; /* Reduce font size for metrics on mobile */
    }
}

/* Ensure content stays behind sidebar when open on mobile */
.main-content {
    position: relative;
    z-index: 1; /* Below sidebar (z-index: 999) */
}
/* Optional: Custom styles for dropdown links */
.dropdown-item {
    display: flex;
    align-items: center; /* Align icons and text vertically */
    padding: 0.5rem 1rem; /* Adjust padding for a cleaner look */
}

.dropdown-item i {
    width: 1.25rem; /* Ensure consistent spacing for icons */
    text-align: center;
}

.dropdown-item:hover {
    background-color: #f8f9fa; /* Lighten hover effect */
    color: #0d6efd; /* Match Bootstrap's primary color */
}

/* Make the table container responsive */
.table-responsive {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on mobile */
        white-space: nowrap;
}

/* Table styling */
.table {
    min-width: 600px; /* Forces horizontal scroll on smaller screens */
    margin-bottom: 0;
}

/* Progress bar styling */
.progress-bar {
    height: 10px;
    background-color: #28a745; /* Green color, adjust as needed */
    border-radius: 5px;
}

/* Adjust for smaller screens */
@media (max-width: 768px) { /* Tablets */
    .table {
        font-size: 14px;
    }
    th, td {
        padding: 8px; /* Reduce padding */
    }
    .progress-bar {
        height: 8px; /* Slightly smaller progress bar */
    }
    .dropdown-menu {
        font-size: 14px;
    }
}

@media (max-width: 576px) { /* Phones */
    .table {
        font-size: 12px;
    }
    th, td {
        padding: 6px; /* Further reduce padding */
    }
    .progress-bar {
        height: 6px; /* Compact progress bar */
    }
    .dropdown-menu {
        font-size: 12px;
    }
}
  /* Chart Card */
.chart-card {
    background-color: #fff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.15),
        0 -4px 15px rgba(255, 255, 255, 0.8),
        inset 0 2px 10px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.03);
    background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%, rgba(245, 245, 245, 1) 100%);
    flex: 1; /* Flex item in charts-row */
    position: relative;
    overflow: hidden;
    width: 100%; /* Ensure it takes full row width */
    box-sizing: border-box;
}

.chart-card::before {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    border-radius: 10px;
   
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    z-index: -1;
}

/* Chart Container */
.chart-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 50%; /* Aspect ratio 2:1 (adjustable) */
}

.chart-container canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100% !important; /* Override inline width */
    height: 100% !important; /* Override inline height */
}

/* Existing Chart Styles */
.chart-card h2 {
    font-size: 16px;
    color: #000;
    margin-bottom: 10px;
}

.chart-subtitle {
    font-size: 12px;
    color: #999;
    margin-bottom: 15px;
}

.chart-update {
    font-size: 12px;
    color: #999;
    text-align: center;
    margin-top: 15px;
}
 .charts-row {
    display: flex;
        flex-direction: row;
    }
.projects-card, .orders-card{
    background-color: #fff; /* White box */
    padding: 20px;
    border-radius: 8px;
    position: relative; /* For pseudo-elements or layering */
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.15), /* Deep outer shadow for lift */
        0 -4px 15px rgba(255, 255, 255, 0.8), /* Top highlight for contrast */
        inset 0 2px 10px rgba(0, 0, 0, 0.05); /* Inner shadow for depth */
    border: 1px solid rgba(0, 0, 0, 0.03); /* Subtle edge definition */
    background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 1) 0%,
        rgba(245, 245, 245, 1) 100%
    ); /* Faint gradient for surface texture */
    z-index: 1; /* Ensure it sits above background */
}

/* Responsive Adjustments */
@media (max-width: 1024px) and (min-width: 769px) { /* Tablet */
   
    .chart-card {
        width: 100%;
        margin-bottom: 20px;
    }
    .chart-container {
        padding-bottom: 60%; /* Slightly taller for tablet */
    }
}

@media (max-width: 768px) { /* Phone */
    .charts-row {
        flex-direction: column;
    }
    .chart-card {
        width: 100%;
        margin-bottom: 20px;
    }
    .chart-container {
        padding-bottom: 75%; /* Taller for phone to fit content */
    }
    .pie{
        padding-bottom: 50%;
    }
    .chart-card h2 {
        font-size: 14px;
    }
    .chart-subtitle, .chart-update {
        font-size: 10px;
    }
}

/* Desktop (above 1024px) */
@media (min-width: 1025px) {
    .charts-row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }
   
}
.add-appointment-btn{
        background: black;
    color: white;
    padding: 10px;
    border-radius: 20px;
    position: absolute;
    top: 10px;
    right: 5px;
    font-weight: bold;
}

</style>
<body>
    <!-- Top Navbar -->
    <nav class="top-navbar">
        <div class="navbar-brand">Creative Tim</div>
        <div class="hamburger">
            <i class="fas fa-bars"></i>
        </div>
    </nav>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <span>Creative Tim</span>
            <i class="fas fa-caret-down"></i>
        </div>
        <ul class="sidebar-menu">
            <li class="active"><i class="fas fa-th-large"></i> Dashboard</li>
            <li><i class="fas fa-table"></i> Tables</li>
            <li><i class="fas fa-file-invoice"></i> Billing</li>
            <li><i class="fas fa-vr-cardboard"></i> Virtual Reality</li>
            <li><i class="fas fa-arrows-alt-h"></i> RTL</li>
            <li><i class="fas fa-bell"></i> Notifications</li>
            <li class="menu-group">ACCOUNT PAGES</li>
            <li><i class="fas fa-user"></i> Profile</li>
            <li><i class="fas fa-sign-in-alt"></i> Sign In</li>
            <li><i class="fas fa-user-plus"></i> Sign Up</li>
        </ul>
        <div class="sidebar-footer">
            <button class="btn-documentation">Documentation</button>
            <button class="btn-upgrade">Upgrade to Pro</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="dashboard">
    <h1>Dashboard</h1>
    <p class="dashboard-subtitle">Check the sales, value and bounce rate by country.</p>



<div class="metrics-row">
    <div class="metric-card col-lg-3">
        <h2>Revenue Today</h2>
        <p class="metric-value">Ksh {{ todays_revenue}}</p>
        <p class="metric-change">+10% than last week</p>
        <i class="fas fa-dollar-sign metric-icon"></i>
    </div>
    <div class="metric-card col-lg-3">
        <h2>Profit Today</h2>
        <p class="metric-value">Ksh {{todays_profit}}</p>
        <p class="metric-change">+5% than last month</p>
        <i class="fas fa-calendar-check metric-icon"></i>
    </div>
    <div class="metric-card col-lg-3">
        <h2>Clients Today</h2>
        <p class="metric-value">{{appointments_today}}</p>
        <p class="metric-change">−3% than yesterday</p>
        <i class="fas fa-eye metric-icon"></i>
    </div>
    <div class="metric-card col-lg-3">
        <h2>Expenses Today</h2>
        <p class="metric-value">$800</p>
        <p class="metric-change">+8% than yesterday</p>
        <i class="fas fa-shopping-cart metric-icon"></i>
    </div>
        <div class="metric-card col-lg-3">
        <h2>Total Revenue</h2>
        <p class="metric-value">ksh {{total_revenue}}</p>
        <p class="metric-change">+10% than last week</p>
        <i class="fas fa-dollar-sign metric-icon"></i>
    </div>
    <div class="metric-card col-lg-3">
        <h2>Total Profits</h2>
        <p class="metric-value">ksh {{total_profit}}</p>
        <p class="metric-change">+5% than last month</p>
        <i class="fas fa-calendar-check metric-icon"></i>
    </div>
    <div class="metric-card col-lg-3">
        <h2>Total Expenses</h2>
        <p class="metric-value">1,200</p>
        <p class="metric-change">−3% than yesterday</p>
        <i class="fas fa-eye metric-icon"></i>
    </div>
    <div class="metric-card col-lg-3">
        <h2>Total clients</h2>
        <p class="metric-value">{{total_appointments}}</p>
        <p class="metric-change">+8% than yesterday</p>
        <i class="fas fa-shopping-cart metric-icon"></i>
    </div>
</div>

    <div class="charts-row">
    <div class="chart-card">
       <h2>Revenue</h2>
        <p class="chart-subtitle">Revenue and Profits for the last 7 months</p>
        <div class="chart-container">
            <canvas id="revenueChart"></canvas>
        </div>
        <p class="chart-update">Updated 2 days ago</p>
    </div>
<div class="chart-card">
    <h2>Service Performance</h2>
    <p class="chart-subtitle">Revenue generated by each service</p>
    <div class="chart-container pie">
        <canvas id="servicePerformanceChart"></canvas>
    </div>
    <p class="chart-update">updated 2 days ago</p>
</div>
  
</div>

    <div class="projects-orders-row">
 <!-- billing/templates/billing/appointment_list.html -->
<div class="projects-card">
    <div class="table-header">
        <h2>Appointments</h2>
        <p class="projects-subtitle">5 completed this month</p>
        <!-- Add Appointment Icon -->
        <button class="add-appointment-btn" data-bs-toggle="modal" data-bs-target="#addAppointmentModal">
            <i class="fas fa-plus"></i> Add Walk-In
        </button>
    </div>
    <div class="table-responsive">
    <table>
        <thead>
            <tr>
                <th>CUSTOMER NAME</th>
                <th>STAFF NAME</th>
                <th>AMOUNT PAID</th>
                <th>COMPLETION</th>
                <th>ACTION</th>
            </tr>
        </thead>
        <tbody>
            {% for appointment in appointments %}
            <tr>
                <td>{{ appointment.customer.first_name }} {{ appointment.customer.last_name }}</td>
                <td>{{ appointment.staff.first_name }} {{ appointment.staff.last_name }}</td>
                <td>${{ appointment.billing.total|default:"0.00" }}</td>
                <td>
                    <div class="progress-bar" style="width: {{ appointment.completion_percentage }}%;"></div>
                </td>
                <!-- Action Column with Dropdown -->
<td>
    <div class="dropdown">
        <!-- Three Dots Button -->
        <button class="btn btn-link text-dark p-0" type="button" id="actionsDropdown{{ appointment.id }}" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-ellipsis-h"></i> <!-- Three vertical dots icon -->
        </button>

        <!-- Dropdown Menu -->
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="actionsDropdown{{ appointment.id }}">
            {% if appointment.status == 'completed' %}
            <li>
                <a class="dropdown-item mark-transacted-link" href="#" data-id="{{ appointment.id }}">
                    <i class="fas fa-check-circle me-2"></i> Mark as Transacted
                </a>
            </li>
            {% endif %}
            <li>
                <a class="dropdown-item edit-link" href="#" data-id="{{ appointment.id }}">
                    <i class="fas fa-edit me-2"></i> Edit
                </a>
            </li>
            <li>
                <a class="dropdown-item cancel-link" href="#" data-id="{{ appointment.id }}">
                    <i class="fas fa-ban me-2"></i> Cancel
                </a>
            </li>
            <li>
                <a class="dropdown-item delete-link" href="#" data-id="{{ appointment.id }}">
                    <i class="fas fa-trash-alt me-2"></i> Delete
                </a>
            </li>
        </ul>
    </div>
</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</div>


        <div class="orders-card">
    <h2>Bookings Overview</h2>
    <p class="orders-subtitle">18% this month</p>
    <ul class="orders-list">
        <li><i class="fas fa-calendar-check"></i> New Booking #456789 - Haircut & Beard Trim <span>22 Feb 3:00 PM</span></li>
        <li><i class="fas fa-spa"></i> Spa Package Ordered #123456 <span>21 Feb 5:30 PM</span></li>
        <li><i class="fas fa-box"></i> Restock Shampoo Supplies <span>20 Feb 2:00 PM</span></li>
        <li><i class="fas fa-user-plus"></i> New Membership Signup #789012 <span>19 Feb 10:00 AM</span></li>
        <li><i class="fas fa-tools"></i> Equipment Maintenance Scheduled <span>18 Feb 9:00 AM</span></li>
    </ul>
</div>
</div>

</div>
    </main>
<footer class="container dashboard-footer">
        <p>© 2025, made with by Creative Tim for a better web.</p>
        <div class="footer-links">
            <span>Creative Tim</span> | <span>About Us</span> | <span>Blog</span> | <i class="fas fa-cog"></i>
        </div>
    </footer>


<!-- Add/Edit Walk-In Appointment Modal -->
<div class="modal fade" id="addAppointmentModal" tabindex="-1" aria-labelledby="addAppointmentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <!-- Dynamic Title -->
                <h5 class="modal-title" id="addAppointmentModalLabel">Add Walk-In Appointment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addWalkInForm">
                    {% csrf_token %}
                    <!-- Hidden Field for Appointment ID (used for editing) -->
                    <input type="hidden" id="appointment_id" name="appointment_id" value="">

                    <div class="mb-3">
                        <label for="walkin_customer_name" class="form-label">Customer Name</label>
                        <input type="text" class="form-control" id="walkin_customer_name" name="walkin_customer_name" placeholder="Enter customer name" required>
                    </div>
                    <div class="mb-3">
                        <label for="walkin_staff_name" class="form-label">Staff Name</label>
                        <select class="form-select" name="walkin_staff_name" id="walkin_staff_name" required>
                            <option value="">Select Staff</option>
                            {% for staff in staff_list %}
                            <option value="{{ staff.id }}">{{ staff.first_name }} {{ staff.last_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="walkin_service" class="form-label">Service</label>
                        <select class="form-select" id="walkin_service" name="walkin_service" required>
                            <option value="">Select Service</option>
                            {% for service in services %}
                            <option value="{{ service.id }}">{{ service.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="walkin_amount_paid" class="form-label">Amount Paid</label>
                        <input type="number" class="form-control" id="walkin_amount_paid" name="walkin_amount_paid" step="0.01" placeholder="Enter amount paid" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 <script>
  <!-- Include Chart.js (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Chart Initialization -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Extract revenue data from Django context
    const revenueData = {{ revenue_data | safe }};

    // Prepare labels and data for the chart
    const labels = revenueData.map(item => item.month);
    const revenue = revenueData.map(item => item.revenue);
    const profit = revenueData.map(item => item.profit);

    // Create the chart
    const ctx = document.getElementById('revenueChart').getContext('2d');
    const revenueChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Revenue (ksh)', // First line
                    data: revenue,
                    borderColor: '#4CAF50', // Green
                    backgroundColor: 'rgba(76, 175, 80, 0.2)',
                    borderWidth: 1,
                    fill: true,
                    tension: 0.3,
                    pointBackgroundColor: '#4CAF50',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4
                },
                {
                    label: 'Profit (ksh)', // Second line
                    data: profit,
                    borderColor: '#2196F3', // Blue
                    backgroundColor: 'rgba(33, 150, 243, 0.2)',
                    borderWidth: 1,
                    fill: true,
                    tension: 0.3,
                    pointBackgroundColor: '#2196F3',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        font: {
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleFont: { size: 14 },
                    bodyFont: { size: 12 },
                    callbacks: {
                        label: function(context) {
                            return `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: {
                            size: 8
                        }
                    }
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        color: '#fff'
                    },
                    ticks: {
                        font: {
                            size: 8
                        },
                        callback: function(value) {
                            return `${value}`;
                        }
                    }
                }
            },
        }
    });

    // Responsive font size adjustment
    function updateChartFontSize() {
        const width = window.innerWidth;
        let tickFontSize = 10;
        let tooltipTitleSize = 10;
        let tooltipBodySize = 10;
        let legendFontSize = 10;

        if (width <= 768) { // Phone
            tickFontSize = 6;
            tooltipTitleSize = 6;
            tooltipBodySize = 6;
            legendFontSize = 6;
        } else if (width <= 1024) { // Tablet
            tickFontSize = 10;
            tooltipTitleSize = 10;
            tooltipBodySize = 10;
            legendFontSize = 10;
        }

        revenueChart.options.scales.x.ticks.font.size = tickFontSize;
        revenueChart.options.scales.y.ticks.font.size = tickFontSize;
        revenueChart.options.plugins.tooltip.titleFont.size = tooltipTitleSize;
        revenueChart.options.plugins.tooltip.bodyFont.size = tooltipBodySize;
        revenueChart.options.plugins.legend.labels.font.size = legendFontSize;
        revenueChart.update();
    }

    // Run on load and resize
    updateChartFontSize();
    window.addEventListener('resize', updateChartFontSize);
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // Extract data from Django context
    const data = {{ service_performance | safe }};

    // Prepare labels and revenue data for the chart
    const labels = data.map(item => item.service);
    const revenues = data.map(item => item.revenue);

    // Create the pie chart
    const ctx = document.getElementById('servicePerformanceChart').getContext('2d');
    const servicePerformanceChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                label: 'Revenue ($)',
                data: revenues,
                backgroundColor: [
                    '#FF6384', // Red
                    '#36A2EB', // Blue
                    '#FFCE56', // Yellow
                    '#4BC0C0', // Teal
                    '#9966FF', // Purple
                    '#FF9F40'  // Orange
                ],
                borderColor: '#fff', // White borders between slices
                borderWidth: 1, // Thicker borders for definition
                hoverOffset: 10 // Slight pop-out on hover
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false, // Fit container’s 1:1 ratio
            plugins: {
                legend: {
                    position: 'right', // Move legend to side for better space use
                    labels: {
                        font: {
                            size: 10 // Base size for desktop
                        },
                        padding: 7
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleFont: { size: 10 },
                    bodyFont: { size: 10 },
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: $${context.raw.toFixed(2)}`;
                        }
                    }
                }
            },
            layout: {
                padding: 0 // Space around the chart
            },
            elements: {
                arc: {
                    borderWidth: 1, // Consistent border width
                    shadowOffsetX: 0, // Add shadow for 3D effect
                    shadowOffsetY: 4,
                    shadowBlur: 10,
                    shadowColor: 'rgba(0, 0, 0, 0.2)'
                }
            }
        }
    });

    // Responsive font size adjustment
    function updateChartFontSize() {
        const width = window.innerWidth;
        let legendFontSize = 10;
        let tooltipTitleSize = 10;
        let tooltipBodySize = 10;

        if (width <= 768) { // Phone
            legendFontSize = 7;
            tooltipTitleSize = 7;
            tooltipBodySize = 7;
        } else if (width <= 1024) { // Tablet
            legendFontSize = 9;
            tooltipTitleSize = 9;
            tooltipBodySize = 9;
        }

        servicePerformanceChart.options.plugins.legend.labels.font.size = legendFontSize;
        servicePerformanceChart.options.plugins.tooltip.titleFont.size = tooltipTitleSize;
        servicePerformanceChart.options.plugins.tooltip.bodyFont.size = tooltipBodySize;
        servicePerformanceChart.update();
    }

    // Run on load and resize
    updateChartFontSize();
    window.addEventListener('resize', updateChartFontSize);
});
</script>
 
   <script>
    document.cookie = "csrftoken={{ csrf_token }}";
</script>
   <script>
     // Function to get the CSRF token from cookies
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Set up CSRF token for all AJAX requests
const csrftoken = getCookie('csrftoken');
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});
    </script>

     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
     $(document).ready(function() {
    // Initialize Select2 for staff dropdown
    $('#walkin_staff_name').select2({
        placeholder: "Search for staff...",
        allowClear: true,
        width: '100%'
    });

    // Initialize Select2 for service dropdown
    $('#walkin_service').select2({
        placeholder: "Search for service...",
        allowClear: true,
        width: '100%'
    });
});
</script>
    <script>
        // JavaScript for hamburger menu toggle (only for tablet/phone)
        document.querySelector('.hamburger').addEventListener('click', function() {
            document.querySelector('.sidebar').classList.toggle('active');
        });
    </script>

    <script type="text/javascript">
 $(document).ready(function() {
    let isEditing = false; // Flag to track if the form is in edit mode

    // Base URL for fetching appointment details (remove trailing slash)
    const getAppointmentDetailsUrl = "{% url 'billing:get_appointment_details' appointment_id=0 %}".replace('/0', '');

    // Open the modal for adding a new appointment
    $('.add-appointment-btn').on('click', function() {
        isEditing = false;
        $('#addAppointmentModalLabel').text('Add Walk-In Appointment'); // Set title
        $('#appointment_id').val(''); // Clear hidden ID field
        $('#addWalkInForm')[0].reset(); // Reset form fields
        $('#addAppointmentModal').modal('show');
    });

    // Open the modal for editing an existing appointment
    $('.edit-link').on('click', function(e) {
        e.preventDefault();
        isEditing = true;
        const appointmentId = $(this).data('id');

        $.ajax({
            url: getAppointmentDetailsUrl + appointmentId + '/', // Add trailing slash
            method: "GET",
            success: function(response) {
                // Populate the form fields with appointment details
                $('#addAppointmentModalLabel').text('Edit Appointment'); // Set title
                $('#appointment_id').val(response.id); // Set hidden ID field
                $('#walkin_customer_name').val(response.customer_name);
                $('#walkin_staff_name').val(response.staff_id);
                $('#walkin_service').val(response.service_id);
                $('#walkin_amount_paid').val(response.amount_paid);

                $('#addAppointmentModal').modal('show');
            },
            error: function() {
                $('#messageBody').text('An unexpected error occurred while fetching appointment details.');
                $('#messageModal').modal('show');
            }
        });
    });

    // Handle form submission
    $('#addWalkInForm').on('submit', function(e) {
        e.preventDefault();

        // Use FormData to include the CSRF token automatically
        const formData = new FormData(this);

        // Construct the URL based on whether we're adding or updating
        const url = isEditing
            ? "{% url 'billing:update_appointment' appointment_id=0 %}".replace('/0', '') + $('#appointment_id').val() + '/'
            : "{% url 'billing:add_walkin_appointment' %}";

        $.ajax({
            url: url,
            method: "POST", // Use POST for both add and update
            data: formData,
            processData: false,  // Don't process the data
            contentType: false,  // Don't set the content type
            success: function(response) {
                if (response.success) {
                    $('#addAppointmentModal').modal('hide'); // Close the modal
                    location.reload(); // Refresh the page to reflect changes
                } else {
                    $('#messageBody').text(response.error);
                    $('#messageModal').modal('show');
                }
            },
            error: function() {
                $('#messageBody').text('An unexpected error occurred. Please try again.');
                $('#messageModal').modal('show');
            }
        });
    });
});
    </script>

    <script type="text/javascript">
  $(document).ready(function() {
    // Base URL for marking an appointment as transacted (remove trailing slash)
    const markAsTransactedUrl = "{% url 'billing:mark_as_transacted' appointment_id=0 %}".replace('/0', '');

    // Handle Mark as Transacted
    $('.mark-transacted-link').on('click', function(e) {
        e.preventDefault(); // Prevent default link behavior
        const appointmentId = $(this).data('id');
        const csrftoken1 =  $('input[name="csrfmiddlewaretoken"]').val();
        console.log(csrftoken1)
        $.ajax({
            url: markAsTransactedUrl + appointmentId + '/', // Add trailing slash here
              headers: { 'X-CSRFToken':csrftoken1 },
            method: "POST",
            
            success: function(response) {
                if (response.success) {
                    location.reload(); // Refresh the page to reflect the updated status
                } else {
                    $('#messageBody').text(response.error);
                    $('#messageModal').modal('show');
                }
            },
            error: function() {
                $('#messageBody').text('An unexpected error occurred. Please try again.');
                $('#messageModal').modal('show');
            }
        });
    });
});
    </script>

    <script type="text/javascript">
  $(document).ready(function() {
    // Base URL for deleting an appointment (remove trailing slash)
    const deleteAppointmentUrl = "{% url 'billing:delete_appointment' appointment_id=0 %}".replace('/0', '');

    // Handle Delete
    $('.delete-link').on('click', function(e) {
        e.preventDefault();
        const appointmentId = $(this).data('id');

        if (confirm('Are you sure you want to delete this appointment?')) {
            $.ajax({
                url: deleteAppointmentUrl + appointmentId + '/', // Ensure proper trailing slash
                method: "POST",
                headers: {
                    "X-CSRFToken": getCookie('csrftoken')
                },
                success: function(response) {
                    if (response.success) {
                        location.reload(); // Refresh the page to reflect the deletion
                    } else {
                        $('#messageBody').text(response.error);
                        $('#messageModal').modal('show');
                    }
                },
                error: function() {
                    $('#messageBody').text('An unexpected error occurred. Please try again.');
                    $('#messageModal').modal('show');
                }
            });
        }
    });
});
    </script>
</body>
</html>